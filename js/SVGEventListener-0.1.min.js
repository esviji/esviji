// SVGEventListener.js
// Version - 0.1
//
// by MAD - @madsgraphics - ecrire[at]madsgraphics.com
//
// https://github.com/madsgraphics/SVGEventListener.js/
//
// Tri-license - WTFPL | MIT | BSD
(function(e,t,n){"use strict";function l(e){var t,n=e.split(":");if(n.length==1)return(t=n[0].lastIndexOf("ms"))!=-1?Number(n[0].substring(0,t)):(t=n[0].lastIndexOf("s"))!=-1?n[0].substring(0,t)*1e3:n[0]*1e3;n.reverse(),e=0;for(var r in n)e+=n[r]*Math.pow(60,r)*1e3;return e}function c(e){this._listeners={},this.autoFire={begin:!1,end:!1},this.parent=e}var r=n.prototype.addEventListener,i=t.createElementNS("http://www.w3.org/2000/svg","svg"),s=function(e){return typeof e=="string"},o=Array.isArray||function(e){return toString.call(e)=="[object Array]"},u=function(e){return e===undefined},a=function(e){return toString.call(e)=="[object Function]"},f=function(e){e="on"+e;var t=e in i;return t||(i.setAttribute(e,"return;"),t=a(i[e])),t};c.prototype={constructor:c,add:function(t,n){u(this._listeners[t])&&(this._listeners[t]=[]),this._listeners[t].push(n)},fire:function(t){s(t)&&(t={type:t});if(!t.target||!t.currentTarget)t.target=t.currentTarget=this.parent;if(!t.type)throw new Error("Event object missing 'type' property.");if(o(this._listeners[t.type])){var n=this._listeners[t.type];for(var r in n)n[r].call(this,t)}}},n.prototype.addEventListener=function(n,i,s){var o,a,h=this.getAttribute("begin"),p=this.getAttribute("dur"),d=this;u(this.listeners)&&(this.listeners=new c(this)),n=="endEvent"&&!f("end")&&(this.listeners.add(n,i),this.listeners.autoFire.end||(this.addEventListener("beginEvent",function(){e.setTimeout(function(){d.listeners.fire("endEvent")},l(p))}),this.listeners.autoFire.end=!0));if(n=="beginEvent"&&!f("begin")){this.listeners.add(n,i);if(h!="indefinite"&&h.indexOf(".end")==-1)this.listeners.autoFire.begin||(e.setTimeout(function(){d.listeners.fire("beginEvent")},l(h)),this.listeners.autoFire.begin=!0);else if((a=h.indexOf(".end"))!=-1){var v=t.getElementById(h.substr(0,a));v.addEventListener("endEvent",function(){d.listeners.fire("beginEvent")})}else h=="indefinite"&&(this.beginElement=function(){return this.listeners.fire("beginEvent"),this.__proto__.beginElement.call(this)})}return r.call(this,n,i,s)}})(this,document,Element);
